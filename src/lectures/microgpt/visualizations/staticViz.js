import React, { useState, useEffect, useMemo } from 'react';
import { useLang } from '../../../core/i18n';
import { VB, VizBox, FlowArrow, FlowBox, StatBox } from '../../../components/SharedComponents';

const CoursePipelineViz = () => { const lang = useLang();  const [active, setActive] = useState(0); const [autoPlay, setAutoPlay] = useState(true); useEffect(() => { if (!autoPlay) return; const t = setInterval(() => setActive(a => (a+1)%7), 2500); return () => clearInterval(t); }, [autoPlay]); const stages = [{l:lang==="tr"?"Veri":"Data",s:"input.txt",c:"#0EA5E9",i:"ğŸ“„",week:lang==="tr"?"Hafta 1":"Week 1",desc:lang==="tr"?"Metin dosyasÄ± okunur. microGPT'de TÃ¼rk isimleri (32K satÄ±r). Her karakter bir token olur â€” vocab: a-z + boÅŸluk = 27 sembol.":"Text file is read. In microGPT, English names (32K lines). Each character becomes a token â€” vocab: a-z + space = 27 symbols."},{l:"Tokenizer",s:"charsâ†’ids",c:"#8B5CF6",i:"ğŸ”¤",week:lang==="tr"?"Hafta 1":"Week 1",desc:lang==="tr"?"Karakterler sayÄ±lara dÃ¶nÃ¼ÅŸÃ¼r: 'emma' â†’ [BOS, 4, 12, 12, 0, BOS]. BOS baÅŸlangÄ±Ã§/bitiÅŸ iÅŸareti. Her ID embedding tablosunda bir satÄ±r seÃ§er.":"Characters become numbers: 'emma' â†’ [BOS, 4, 12, 12, 0, BOS]. BOS marks start/end. Each ID selects a row in the embedding table."},{l:"Model",s:"Emb+Attn+MLP",c:"#10B981",i:"ğŸ§ ",week:lang==="tr"?"Hafta 3-4":"Week 3-4",desc:lang==="tr"?"Token ID'ler 16 boyutlu vektÃ¶rlere dÃ¶nÃ¼ÅŸÃ¼r (embedding). Attention her tokenin diÄŸerlerinden bilgi almasÄ±nÄ± saÄŸlar. MLP bu bilgiyi iÅŸler.":"Token IDs become 16-dimensional vectors (embedding). Attention lets each token gather info from others. MLP processes this info."},{l:"Loss",s:"Cross-Entropy",c:"#EF4444",i:"ğŸ“‰",week:lang==="tr"?"Hafta 5":"Week 5",desc:lang==="tr"?"Model 'e' dediyse ama doÄŸru cevap 'm' ise, kayÄ±p yÃ¼ksek olur. KayÄ±p = -log(doÄŸru tokene verilen olasÄ±lÄ±k). DÃ¼ÅŸÃ¼k loss = iyi model.":"If model said 'e' but correct answer is 'm', loss is high. Loss = -log(probability given to correct token). Low loss = good model."},{l:"Backprop",s:"Autograd",c:"#F59E0B",i:"â›“",week:lang==="tr"?"Hafta 2":"Week 2",desc:lang==="tr"?"KayÄ±p geriye doÄŸru yayÄ±lÄ±r. Her parametreye 'bu kaybÄ± azaltmak iÃ§in seni ne kadar deÄŸiÅŸtirmeliyim?' sorusunun cevabÄ± hesaplanÄ±r (gradient).":"Loss propagates backward. For each parameter: 'how much should I change you to reduce this loss?' is computed (gradient)."},{l:"Update",s:"Adam",c:"#EC4899",i:"ğŸ”§",week:lang==="tr"?"Hafta 5":"Week 5",desc:lang==="tr"?"Gradient yÃ¶nÃ¼nde kÃ¼Ã§Ã¼k bir adÄ±m at: w = w - lr Ã— grad. Adam optimizer momentum ve adaptif lr ile bunu akÄ±llÄ±ca yapar. Sonra grad sÄ±fÄ±rlanÄ±r.":"Take a small step in gradient direction: w = w - lr Ã— grad. Adam optimizer does this smartly with momentum and adaptive lr. Then grad is zeroed."},{l:"Inference",s:"Sampling",c:"#6366F1",i:"âœ¨",week:lang==="tr"?"Hafta 6":"Week 6",desc:lang==="tr"?"EÄŸitilmiÅŸ model yeni isimler Ã¼retir: 'A' ver â†’ 'Ahmet' Ã§Ä±kar. Her adÄ±mda olasÄ±lÄ±k daÄŸÄ±lÄ±mÄ±ndan bir token Ã¶rneklenir. Temperature yaratÄ±cÄ±lÄ±ÄŸÄ± kontrol eder.":"Trained model generates new names: give 'A' â†’ get 'Ahmet'. Each step samples a token from the probability distribution. Temperature controls creativity."}]; return (<VizBox title={lang === "tr" ? "7 AÅŸamalÄ± Pipeline â€” TÃ¼m Ders HaritasÄ±" : "7-Stage Pipeline â€” Full Course Map"} color="#0EA5E9"><div style={{fontSize:13,color:"#94A3B8",marginBottom:10,lineHeight:1.6}}>{lang === "tr" ? "AÅŸaÄŸÄ±daki kutularÄ±n her biri microGPT'nin bir adÄ±mÄ±nÄ± temsil eder. TÄ±klayarak detaylarÄ± gÃ¶rÃ¼n." : "Each box represents a step of microGPT. Click to see details."}</div><div style={{display:"flex",alignItems:"center",gap:4,flexWrap:"wrap",justifyContent:"center"}}>{stages.map((s,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:4}}><div onClick={()=>{setAutoPlay(false);setActive(i);}} style={{padding:"10px 12px",borderRadius:10,textAlign:"center",minWidth:80,cursor:"pointer",background:i===active?`${s.c}20`:`${s.c}08`,border:`1.5px solid ${i===active?s.c:`${s.c}20`}`,transform:i===active?"scale(1.08)":"scale(1)",transition:"all .4s cubic-bezier(.34,1.56,.64,1)"}}><div style={{fontSize:21,marginBottom:2}}>{s.i}</div><div style={{fontSize:14,fontWeight:700,color:s.c}}>{s.l}</div><div style={{fontSize:11,color:VB.muted}}>{s.s}</div></div>{i<6&&<FlowArrow color={i===active?s.c:VB.dim}/>}</div>))}</div><div style={{marginTop:12,padding:"14px 16px",borderRadius:12,background:`${stages[active].c}08`,border:`1.5px solid ${stages[active].c}25`,transition:"all .4s"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}><span style={{fontSize:16,fontWeight:800,color:stages[active].c}}>{stages[active].i} {stages[active].l}</span><span style={{fontSize:12,padding:"2px 8px",borderRadius:6,background:`${stages[active].c}15`,color:stages[active].c,fontWeight:600}}>{stages[active].week}</span></div><div style={{fontSize:14,color:"#CBD5E1",lineHeight:1.7}}>{stages[active].desc}</div></div><div style={{marginTop:8,padding:"6px 12px",background:"rgba(245,158,11,.06)",borderRadius:8,textAlign:"center"}}><span style={{fontSize:13,color:"#F59E0B"}}>{lang === "tr" ? "â† EÄŸitim DÃ¶ngÃ¼sÃ¼: forward â†’ loss â†’ backward â†’ update â†’ tekrarla (500+ adÄ±m) â†’" : "â† Training Loop: forward â†’ loss â†’ backward â†’ update â†’ repeat (500+ steps) â†’"}</span></div></VizBox>); };

const TokenFlowViz = () => { const lang = useLang();  const steps = [{l:'"anna"',s:lang==="tr"?"Girdi":"Input",c:"#0EA5E9"},{l:"a n n a",s:lang==="tr"?"Karakter AyÄ±r":"Split Chars",c:"#8B5CF6"},{l:"2 15 15 2",s:lang==="tr"?"ID Ã‡evir":"To IDs",c:"#10B981"},{l:"0 2 15 15 2 0",s:"+BOS",c:"#F59E0B"}]; return (<VizBox title={lang === "tr" ? "Tokenization AkÄ±ÅŸÄ±" : "Tokenization Flow"} color="#8B5CF6"><div style={{display:"flex",alignItems:"center",gap:6,justifyContent:"center",flexWrap:"wrap"}}>{steps.map((s,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:6}}><FlowBox label={s.l} sub={s.s} color={s.c}/>{i<3&&<FlowArrow color={s.c}/>}</div>))}</div><div style={{display:"flex",gap:16,marginTop:14,justifyContent:"center",flexWrap:"wrap"}}><div style={{background:VB.card,padding:"8px 14px",borderRadius:8}}><span style={{fontSize: 12,color:VB.muted}}>EÄŸitim Ã§iftleri: </span><span style={{fontSize: 13,fontFamily:"'Fira Code',monospace",color:"#10B981"}}>(BOSâ†’a),(aâ†’n),(nâ†’n),(nâ†’a),(aâ†’BOS)</span></div></div></VizBox>); };

const EmbeddingFlowViz = () => { const lang = useLang();  const bars = useMemo(()=>Array.from({length:16},()=>-0.3+Math.random()*0.6),[]); const posBars = useMemo(()=>Array.from({length:16},()=>-0.1+Math.random()*0.2),[]); const sumBars = useMemo(()=>bars.map((b,i)=>b+posBars[i]),[bars,posBars]); const mx = Math.max(...bars.map(Math.abs),...posBars.map(Math.abs),...sumBars.map(Math.abs),0.01); const BarRow = ({data,label,color})=>(<div><div style={{fontSize: 13,color,fontWeight:600,marginBottom:4}}>{label}</div><div style={{display:"flex",gap:2}}>{data.map((v,i)=>(<div key={i} style={{width:16,height:28,borderRadius:3,background:v>0?`rgba(14,165,233,${Math.abs(v)/mx})`:`rgba(239,68,68,${Math.abs(v)/mx})`}} title={`dim${i}: ${v.toFixed(3)}`}/>))}</div></div>); return (<VizBox title={lang === "tr" ? "Embedding â†’ Position â†’ BirleÅŸim" : "Embedding â†’ Position â†’ Combination"} color="#0EA5E9"><div style={{display:"flex",gap:20,alignItems:"flex-start",flexWrap:"wrap"}}><BarRow data={bars} label="Token Emb (wte['a'])" color="#0EA5E9"/><div style={{display:"flex",alignItems:"center",height:42,fontSize: 19,color:VB.muted,fontWeight:700}}>+</div><BarRow data={posBars} label="Pos Emb (wpe[0])" color="#8B5CF6"/><div style={{display:"flex",alignItems:"center",height:42,fontSize: 19,color:VB.muted,fontWeight:700}}>=</div><BarRow data={sumBars} label="x = tok + pos" color="#10B981"/></div><div style={{marginTop:8,fontSize: 12,color:VB.dim}}>Her Ã§ubuk = 1 boyut. Mavi=pozitif, KÄ±rmÄ±zÄ±=negatif. 16-boyutlu vektÃ¶r.</div></VizBox>); };

const CompGraphViz = () => { const lang = useLang();  const nodes = [{l:"a",v:"2",g:"3",cx:13,cy:20,c:"#0EA5E9"},{l:"b",v:"3",g:"2",cx:13,cy:65,c:"#0EA5E9"},{l:"d=aÃ—b",v:"6",g:"1",cx:53,cy:37,c:"#F59E0B"},{l:"c",v:"1",g:"1",cx:53,cy:78,c:"#0EA5E9"},{l:"L=d+c",v:"7",g:"1",cx:90,cy:55,c:"#EF4444"}]; return (<VizBox title={lang === "tr" ? "Hesaplama GrafÄ± â€” L = (a Ã— b) + c" : "Computation Graph â€” L = (a Ã— b) + c"} color="#F59E0B"><div style={{display:"flex",gap:20,flexWrap:"wrap"}}><svg viewBox="0 0 120 95" style={{width:320,height:250}}><line x1="22" y1="24" x2="42" y2="37" stroke="#0EA5E9" strokeWidth="0.7" strokeDasharray="2,2"/><line x1="22" y1="68" x2="42" y2="42" stroke="#0EA5E9" strokeWidth="0.7" strokeDasharray="2,2"/><line x1="64" y1="40" x2="80" y2="55" stroke="#F59E0B" strokeWidth="0.7" strokeDasharray="2,2"/><line x1="62" y1="80" x2="80" y2="60" stroke="#0EA5E9" strokeWidth="0.7" strokeDasharray="2,2"/><text x="2" y="8" fill="#0EA5E9" fontSize="4" fontWeight="600">FORWARD â†’</text><text x="82" y="8" fill="#EF4444" fontSize="4" fontWeight="600">â† BACKWARD</text>{nodes.map((n,i)=>(<g key={i}><ellipse cx={n.cx} cy={n.cy} rx="13" ry="8" fill="#111827" stroke={n.c} strokeWidth="0.7"/><text x={n.cx} y={n.cy-1} fill={n.c} fontSize="4" fontWeight="700" textAnchor="middle">{n.l}</text><text x={n.cx} y={n.cy+5} fill="#64748B" fontSize="2.5" textAnchor="middle">data={n.v} grad={n.g}</text></g>))}</svg><div style={{flex:1,minWidth:200}}><div style={{fontSize: 14,fontWeight:600,color:"#F59E0B",marginBottom:6}}>{lang === "tr" ? "Chain Rule AdÄ±mlarÄ±" : "Chain Rule Steps"}</div>{[{eq:"âˆ‚L/âˆ‚L = 1",c:"#EF4444",n:lang==="tr"?"baÅŸlangÄ±Ã§":"start"},{eq:"âˆ‚L/âˆ‚d = 1Ã—1 = 1",c:"#F59E0B",n:"âˆ‚(d+c)/âˆ‚d"},{eq:"âˆ‚L/âˆ‚c = 1Ã—1 = 1",c:"#0EA5E9",n:"âˆ‚(d+c)/âˆ‚c"},{eq:"âˆ‚L/âˆ‚a = 1Ã—b = 3",c:"#0EA5E9",n:"âˆ‚(aÃ—b)/âˆ‚a=b"},{eq:"âˆ‚L/âˆ‚b = 1Ã—a = 2",c:"#0EA5E9",n:"âˆ‚(aÃ—b)/âˆ‚b=a"}].map((s,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:"4px 8px",borderRadius:6,marginBottom:3,background:`${s.c}08`}}><span style={{fontSize: 14,fontFamily:"'Fira Code',monospace",fontWeight:600,color:s.c}}>{s.eq}</span><span style={{fontSize: 12,color:VB.dim}}>{s.n}</span></div>))}<div style={{marginTop:8,padding:"6px 10px",borderRadius:6,background:"rgba(239,68,68,.06)",border:"1px solid rgba(239,68,68,.15)"}}><span style={{fontSize: 12,color:"#EF4444",fontWeight:600}}>{lang === "tr" ? "Kritik: grad += (= deÄŸil!) â€” Gradientler TOPLANIR." : "Critical: grad += (not =!) â€” Gradients ACCUMULATE."}</span></div></div></div></VizBox>); };

const OpGradTableViz = () => { const lang = useLang();  const ops = [{op:"z = a + b",g:"âˆ‚z/âˆ‚a=1, âˆ‚z/âˆ‚b=1",c:"#0EA5E9"},{op:"z = a Ã— b",g:"âˆ‚z/âˆ‚a=b, âˆ‚z/âˆ‚b=a",c:"#10B981"},{op:"z = log(a)",g:"âˆ‚z/âˆ‚a = 1/a",c:"#8B5CF6"},{op:"z = exp(a)",g:"âˆ‚z/âˆ‚a = exp(a)",c:"#F59E0B"},{op:"z = relu(a)",g:"âˆ‚z/âˆ‚a = (a>0?1:0)",c:"#EC4899"},{op:"z = aâ¿",g:"âˆ‚z/âˆ‚a = nÂ·aâ¿â»Â¹",c:"#EF4444"}]; return (<VizBox title={lang === "tr" ? "OperatÃ¶r â†’ Yerel Gradient Tablosu" : "Operator â†’ Local Gradient Table"} color="#10B981"><div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6}}>{ops.map((o,i)=>(<div key={i} style={{padding:"10px 12px",borderRadius:8,background:`${o.c}08`,borderLeft:`3px solid ${o.c}`}}><div style={{fontSize: 15,fontWeight:700,fontFamily:"'Fira Code',monospace",color:o.c}}>{o.op}</div><div style={{fontSize: 13,fontFamily:"'Fira Code',monospace",color:VB.txt,marginTop:3}}>{o.g}</div></div>))}</div></VizBox>); };

const ArchPipelineViz = () => { const [hov,setHov]=useState(-1); const pipe=[{l:"Token\nEmbed",s:"wte[id]â†’[16]",c:"#0EA5E9"},{l:"Pos\nEmbed",s:"+wpe[pos]",c:"#8B5CF6"},{l:"RMS\nNorm",s:"x/âˆš(rms+Îµ)",c:"#F59E0B"},{l:"Self\nAttn",s:"QÂ·Káµ€/âˆšdâ†’V",c:"#10B981"},{l:"MLP",s:"fc1â†’ReLUÂ²â†’fc2",c:"#EC4899"},{l:"LM\nHead",s:"â†’logits[28]",c:"#EF4444"}]; return (<VizBox title="GPT Forward Pass â€” Tam Mimari" color="#10B981"><div style={{display:"flex",alignItems:"center",gap:4,justifyContent:"center",flexWrap:"wrap"}}>{pipe.map((p,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:4}} onMouseEnter={()=>setHov(i)} onMouseLeave={()=>setHov(-1)}><div style={{padding:"12px 14px",borderRadius:10,textAlign:"center",minWidth:85,background:hov===i?`${p.c}20`:`${p.c}0A`,border:`1.5px solid ${hov===i?p.c:`${p.c}30`}`,transform:hov===i?"scale(1.08)":"scale(1)",transition:"all .3s cubic-bezier(.34,1.56,.64,1)",boxShadow:hov===i?`0 0 16px ${p.c}20`:"none"}}><div style={{fontSize: 15,fontWeight:700,color:p.c,whiteSpace:"pre-line",lineHeight:1.3}}>{p.l}</div><div style={{fontSize: 11,color:VB.muted,marginTop:3,fontFamily:"'Fira Code',monospace"}}>{p.s}</div></div>{i<5&&<FlowArrow color={p.c}/>}</div>))}</div><div style={{display:"flex",gap:6,marginTop:12,justifyContent:"center",flexWrap:"wrap"}}><div style={{padding:"4px 10px",borderRadius:6,background:"rgba(16,185,129,.08)",fontSize: 12,color:"#10B981",fontFamily:"'Fira Code',monospace"}}>â†° Residual: x = attn(norm(x)) + x</div><div style={{padding:"4px 10px",borderRadius:6,background:"rgba(236,72,153,.08)",fontSize: 12,color:"#EC4899",fontFamily:"'Fira Code',monospace"}}>â†° Residual: x = mlp(norm(x)) + x</div></div></VizBox>); };

const AttentionFlowViz = () => { const lang = useLang();  const hc=["#0EA5E9","#10B981","#F59E0B","#EC4899"]; return (<VizBox title={lang === "tr" ? "Self-Attention â€” DetaylÄ± AkÄ±ÅŸ" : "Self-Attention â€” Detailed Flow"} color="#10B981"><div style={{display:"flex",gap:24,flexWrap:"wrap"}}><div><div style={{fontSize: 14,fontWeight:600,color:"#0EA5E9",marginBottom:8}}>{lang === "tr" ? "1. Q, K, V Ãœretimi" : "1. Q, K, V Generation"}</div><div style={{display:"flex",alignItems:"center",gap:6}}><FlowBox label="x [16]" color="#94A3B8" small/><div style={{display:"flex",flexDirection:"column",gap:4}}>{[{l:"Q",c:"#10B981"},{l:"K",c:"#F59E0B"},{l:"V",c:"#EC4899"}].map(p=>(<div key={p.l} style={{display:"flex",alignItems:"center",gap:4}}><FlowArrow color={VB.dim}/><FlowBox label={`W${p.l.toLowerCase()}Â·x`} color={p.c} small/><FlowArrow color={VB.dim}/><FlowBox label={`${p.l} [16]`} color={p.c} small/></div>))}</div></div></div><div><div style={{fontSize: 14,fontWeight:600,color:"#10B981",marginBottom:8}}>{lang === "tr" ? "2. Scaled Dot-Product" : "2. Scaled Dot-Product"}</div><div style={{display:"flex",alignItems:"center",gap:4}}>{[{l:"QÂ·Káµ€",c:"#10B981"},{l:"Ã·âˆšd",c:"#F59E0B"},{l:"Softmax",c:"#8B5CF6"},{l:"Ã—V",c:"#EC4899"}].map((s,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:4}}><FlowBox label={s.l} color={s.c} small active/>{i<3&&<FlowArrow color={VB.dim}/>}</div>))}</div><div style={{fontSize: 14,fontWeight:600,color:"#8B5CF6",marginTop:12,marginBottom:6}}>{lang === "tr" ? "3. Multi-Head (4 Ã— 4 dim)" : "3. Multi-Head (4 Ã— 4 dim)"}</div><div style={{display:"flex",gap:4}}>{[0,1,2,3].map(h=>(<div key={h} style={{flex:1,padding:"8px 6px",borderRadius:8,textAlign:"center",background:`${hc[h]}10`,border:`1.5px solid ${hc[h]}30`}}><div style={{fontSize: 13,fontWeight:700,color:hc[h]}}>Head {h}</div><div style={{fontSize: 11,color:VB.muted,fontFamily:"'Fira Code',monospace"}}>q[{h*4}:{h*4+4}]</div></div>))}</div></div></div></VizBox>); };

const CausalMaskViz = () => { const toks=["B","a","n","n","a"]; const wts=[[1.0],[.4,.6],[.2,.3,.5],[.1,.2,.3,.4],[.05,.15,.2,.25,.35]]; return (<VizBox title="Causal Attention Matrix" color="#F59E0B"><div style={{display:"flex",gap:20,alignItems:"flex-start",flexWrap:"wrap"}}><div><div style={{display:"flex",marginLeft:28}}>{toks.map((t,i)=>(<div key={i} style={{width:36,textAlign:"center",fontSize: 13,color:VB.muted,fontFamily:"'Fira Code',monospace"}}>{t}</div>))}</div>{toks.map((t,r)=>(<div key={r} style={{display:"flex",alignItems:"center"}}><div style={{width:24,fontSize: 13,color:VB.muted,fontFamily:"'Fira Code',monospace",textAlign:"right",paddingRight:4}}>{t}</div>{toks.map((_,c)=>{const masked=c>r;const w=!masked&&wts[r]?(wts[r][c]||0):0;return(<div key={c} style={{width:34,height:34,margin:1,borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center",fontSize: 11,fontFamily:"'Fira Code',monospace",background:masked?"rgba(255,255,255,0.02)":`rgba(16,185,129,${w*0.9})`,color:masked?"#1E293B":w>0.3?"#fff":"rgba(16,185,129,.6)"}}>{masked?"âœ—":w.toFixed(1)}</div>);})}</div>))}<div style={{marginTop:6,fontSize: 12,color:VB.dim}}><span style={{color:"#10B981"}}>â– </span> koyu=yÃ¼ksek dikkat <span style={{color:"#1E293B"}}>âœ—</span>=mask</div></div><div style={{flex:1,minWidth:180}}><div style={{fontSize: 13,color:VB.txt,lineHeight:1.6}}><strong style={{color:"#F59E0B"}}>Causal masking:</strong> Her token sadece kendisi ve Ã¶nceki token'lara bakabilir.<br/><br/><strong style={{color:"#10B981"}}>Bu kodda mask yok!</strong> KV cache doÄŸal masking saÄŸlar â€” gelecek tokenlar cache'te yok.</div></div></div></VizBox>); };

const MLPFlowViz = () => { const lang = useLang();  const neurons=useMemo(()=>Array.from({length:64},()=>Math.random()>0.38),[]); return (<VizBox title={lang === "tr" ? "MLP Block â€” GeniÅŸlet â†’ Aktive Et â†’ Daralt" : "MLP Block â€” Expand â†’ Activate â†’ Compress"} color="#EC4899"><div style={{display:"flex",alignItems:"center",gap:4,justifyContent:"center",flexWrap:"wrap",marginBottom:12}}>{[{l:"x [16]",c:"#94A3B8"},{l:"RMSNorm",c:"#F59E0B"},{l:"fc1: 16â†’64",c:"#8B5CF6"},{l:"ReLUÂ²",c:"#EC4899"},{l:"fc2: 64â†’16",c:"#10B981"},{l:"+residual",c:"#EF4444"}].map((s,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:4}}><FlowBox label={s.l} color={s.c} small/>{i<5&&<FlowArrow color={VB.dim}/>}</div>))}</div><div><div style={{fontSize: 13,color:VB.muted,marginBottom:6}}>64 NÃ¶ron (ReLUÂ² sonrasÄ±): <span style={{color:"#EC4899"}}>â– </span> {lang === "tr" ? "aktif" : "active"} <span style={{color:"#1E293B"}}>â–¡</span> {lang === "tr" ? "Ã¶lÃ¼" : "dead"}</div><div style={{display:"flex",flexWrap:"wrap",gap:2,maxWidth:340}}>{neurons.map((a,i)=>(<div key={i} style={{width:16,height:16,borderRadius:3,background:a?"rgba(236,72,153,0.5)":"rgba(255,255,255,0.03)",border:a?"none":"1px solid rgba(255,255,255,0.04)"}}/>))}</div><div style={{marginTop:6,display:"flex",gap:16,fontSize: 13,color:VB.muted}}><span>{lang === "tr" ? "Aktif:" : "Active:"} <strong style={{color:"#10B981"}}>{neurons.filter(Boolean).length}</strong>/64</span><span>{lang === "tr" ? "Ã–lÃ¼:" : "Dead:"} <strong style={{color:"#EF4444"}}>{neurons.filter(n=>!n).length}</strong>/64</span><span>Sparsity: <strong style={{color:"#F59E0B"}}>{((neurons.filter(n=>!n).length/64)*100).toFixed(0)}%</strong></span></div></div></VizBox>); };

const ParamDistViz = () => { const lang = useLang();  const params=[{l:"wte (Token Emb)",v:432,c:"#0EA5E9",d:"27Ã—16"},{l:"wpe (Pos Emb)",v:128,c:"#8B5CF6",d:"8Ã—16"},{l:"Q,K,V,O (Attn)",v:1024,c:"#10B981",d:"4Ã—[16Ã—16]"},{l:"fc1+fc2 (MLP)",v:2048,c:"#EC4899",d:"64Ã—16+16Ã—64"}]; const total=params.reduce((s,p)=>s+p.v,0); const mx=Math.max(...params.map(p=>p.v)); return (<VizBox title={lang === "tr" ? "Parametre DaÄŸÄ±lÄ±mÄ± â€” 3,648 DeÄŸer" : "Parameter Distribution â€” 3,648 Values"} color="#EC4899"><div style={{display:"flex",gap:20,flexWrap:"wrap"}}><div style={{flex:1,minWidth:260}}>{params.map((p,i)=>(<div key={i} style={{marginBottom:8}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:3}}><span style={{fontSize: 13,color:p.c,fontWeight:600}}>{p.l}</span><span style={{fontSize: 13,fontFamily:"'Fira Code',monospace",color:VB.muted}}>{p.v} ({((p.v/total)*100).toFixed(0)}%)</span></div><div style={{height:14,background:"rgba(255,255,255,0.03)",borderRadius:7,overflow:"hidden"}}><div style={{height:"100%",width:`${(p.v/mx)*100}%`,borderRadius:7,background:p.c,transition:"width .6s"}}/></div><div style={{fontSize: 11,color:VB.dim,marginTop:2}}>{p.d}</div></div>))}</div><div style={{display:"flex",flexDirection:"column",gap:6}}><StatBox value="3,648" label={lang === "tr" ? "Toplam" : "Total"} color="#0EA5E9"/><StatBox value="56%" label={lang === "tr" ? "MLP PayÄ±" : "MLP Share"} color="#EC4899"/><StatBox value="28%" label={lang === "tr" ? "Attn PayÄ±" : "Attn Share"} color="#10B981"/></div></div></VizBox>); };

const TrainingCycleViz = () => { const lang = useLang();  const [phase,setPhase]=useState(0); useEffect(()=>{const t=setInterval(()=>setPhase(p=>(p+1)%4),1200);return()=>clearInterval(t);},[]);const phases=[{l:"FORWARD",s:"gpt(tok,pos)â†’logits",c:"#0EA5E9",i:"â†’"},{l:"LOSS",s:"CE=-log(P_target)",c:"#EF4444",i:"ğŸ“‰"},{l:"BACKWARD",s:"loss.backward()â†’grads",c:"#F59E0B",i:"â†"},{l:"UPDATE",s:"p-=lrÃ—mÌ‚/(âˆšvÌ‚+Îµ)",c:"#10B981",i:"ğŸ”§"}]; return (<VizBox title={lang === "tr" ? "EÄŸitim DÃ¶ngÃ¼sÃ¼ â€” Cycle" : "Training Loop â€” Cycle"} color="#F59E0B"><div style={{display:"flex",justifyContent:"center",gap:10,flexWrap:"wrap"}}>{phases.map((p,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:10}}><div style={{padding:"14px 18px",borderRadius:12,textAlign:"center",minWidth:110,background:i===phase?`${p.c}20`:`${p.c}08`,border:`2px solid ${i===phase?p.c:`${p.c}20`}`,transform:i===phase?"scale(1.1)":"scale(1)",transition:"all .4s cubic-bezier(.34,1.56,.64,1)",boxShadow:i===phase?`0 0 20px ${p.c}30`:"none"}}><div style={{fontSize: 19,marginBottom:2}}>{p.i}</div><div style={{fontSize: 16,fontWeight:700,color:p.c}}>{p.l}</div><div style={{fontSize: 11,fontFamily:"'Fira Code',monospace",color:VB.muted,marginTop:2}}>{p.s}</div></div>{i<3&&<div style={{fontSize: 19,color:i===phase?p.c:VB.dim,transition:"color .3s"}}>â†’</div>}</div>))}</div><div style={{marginTop:10,textAlign:"center",fontSize: 13,color:VB.muted}}>{lang === "tr" ? "Her step tekrarlanÄ±r" : "Each step repeats"} â€¢ <span style={{color:"#EF4444"}}>Kritik: p.grad = 0</span></div></VizBox>); };

const LossTableViz = () => { const lang = useLang();  const rows=[{p:"1.0",l:"0.00",n:lang === "tr" ? "MÃ¼kemmel" : "Perfect",c:"#10B981"},{p:"0.5",l:"0.69",n:lang === "tr" ? "YarÄ± yarÄ±ya" : "Half & half",c:"#F59E0B"},{p:"0.1",l:"2.30",n:lang === "tr" ? "KÃ¶tÃ¼" : "Bad",c:"#EF4444"},{p:"1/27",l:"3.33",n:lang === "tr" ? "Rastgele(baÅŸlangÄ±Ã§)" : "Random(start)",c:"#EF4444"}]; return (<VizBox title="Cross-Entropy: P(target) vs Loss" color="#EF4444"><div style={{display:"flex",gap:20,flexWrap:"wrap"}}><div>{rows.map((r,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",borderRadius:6,marginBottom:4,background:`${r.c}08`}}><span style={{width:60,fontSize: 14,fontFamily:"'Fira Code',monospace",color:VB.txt}}>P={r.p}</span><span style={{width:50,fontSize: 14,fontFamily:"'Fira Code',monospace",fontWeight:700,color:r.c}}>L={r.l}</span><span style={{fontSize: 13,color:VB.muted}}>{r.n}</span></div>))}</div><div style={{padding:"10px 14px",background:VB.card,borderRadius:8}}><div style={{fontSize: 16,fontFamily:"'Fira Code',monospace",color:"#EF4444",fontWeight:700}}>L = -(1/n) Î£ log P(target_i)</div><div style={{fontSize: 13,color:VB.muted,marginTop:6,lineHeight:1.5}}>DÃ¼ÅŸÃ¼k P â†’ yÃ¼ksek sÃ¼rpriz â†’ yÃ¼ksek loss<br/>BaÅŸlangÄ±Ã§: L â‰ˆ 3.33 = -log(1/27)</div></div></div></VizBox>); };

const AdamEvolutionViz = () => { const lang = useLang();  const opts=[{l:"SGD",eq:"p-=lrÃ—g",d:lang==="tr"?"Basit":"Simple",c:"#64748B"},{l:"Momentum",eq:"m=Î²â‚m+g",d:lang==="tr"?"YÃ¶n bilgisi":"Direction info",c:"#F59E0B"},{l:"RMSprop",eq:"v=Î²â‚‚v+gÂ²",d:lang==="tr"?"Adaptif":"Adaptive",c:"#8B5CF6"},{l:"Adam â˜…",eq:"mÌ‚/(âˆšvÌ‚+Îµ)",d:lang==="tr"?"BirleÅŸik":"Combined",c:"#10B981"}]; return (<VizBox title="SGD â†’ Momentum â†’ RMSprop â†’ Adam" color="#10B981"><div style={{display:"flex",alignItems:"center",gap:6,justifyContent:"center",flexWrap:"wrap"}}>{opts.map((o,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:6}}><div style={{padding:"10px 14px",borderRadius:10,textAlign:"center",minWidth:100,background:`${o.c}0A`,border:`1.5px solid ${o.c}30`}}><div style={{fontSize: 15,fontWeight:700,color:o.c}}>{o.l}</div><div style={{fontSize: 12,fontFamily:"'Fira Code',monospace",color:VB.muted,marginTop:2}}>{o.eq}</div><div style={{fontSize: 11,color:VB.dim,marginTop:2}}>{o.d}</div></div>{i<3&&<FlowArrow color={VB.dim}/>}</div>))}</div></VizBox>); };

const InferenceTimelineViz = () => { const [step,setStep]=useState(0); const steps=[{inp:"BOS",out:"k",p:".08"},{inp:"k",out:"a",p:".15"},{inp:"a",out:"m",p:".11"},{inp:"m",out:"r",p:".09"},{inp:"r",out:"i",p:".22"},{inp:"i",out:"n",p:".18"},{inp:"n",out:"BOS",p:".31"}]; useEffect(()=>{const t=setInterval(()=>setStep(s=>(s+1)%8),1000);return()=>clearInterval(t);},[]);return (<VizBox title="Autoregressive Generation â€” 'kamrin'" color="#6366F1"><div style={{display:"flex",gap:4,justifyContent:"center",flexWrap:"wrap"}}>{steps.map((s,i)=>(<div key={i} style={{display:"flex",flexDirection:"column",alignItems:"center",gap:3,opacity:i<step?1:0.3,transition:"opacity .4s"}}><div style={{padding:"4px 10px",borderRadius:6,fontSize: 15,fontFamily:"'Fira Code',monospace",fontWeight:700,color:"#0EA5E9",background:"rgba(14,165,233,.1)"}}>{s.inp}</div><div style={{fontSize: 13,color:VB.dim}}>â†“GPT</div><div style={{padding:"4px 10px",borderRadius:6,fontSize: 15,fontFamily:"'Fira Code',monospace",fontWeight:700,color:s.out==="BOS"?"#EF4444":"#10B981",background:s.out==="BOS"?"rgba(239,68,68,.1)":"rgba(16,185,129,.1)"}}>{s.out}</div><div style={{fontSize: 11,fontFamily:"'Fira Code',monospace",color:VB.dim}}>P={s.p}</div></div>))}</div><div style={{marginTop:10,textAlign:"center",padding:"6px 14px",background:"rgba(16,185,129,.06)",borderRadius:8}}><span style={{fontSize: 15,color:VB.muted}}>SonuÃ§: </span><span style={{fontSize: 19,fontFamily:"'Fira Code',monospace",fontWeight:800,color:"#10B981"}}>"kamrin"</span><span style={{fontSize: 13,color:VB.dim}}> â€” veri setinde yok ama yapÄ±ya uygun!</span></div></VizBox>); };

const TemperatureViz = () => { const logits=[2.4,1.8,0.5,-0.3,-1.0]; const labels=["a","n","e","i","t"]; const calcP=(t)=>{const s=logits.map(l=>l/t);const mx=Math.max(...s);const e=s.map(l=>Math.exp(l-mx));const sm=e.reduce((a,b)=>a+b);return e.map(v=>v/sm);}; const temps=[{t:0.2,label:"T=0.2 (sivri)",c:"#0EA5E9"},{t:0.8,label:"T=0.8 (dengeli)",c:"#10B981"},{t:1.5,label:"T=1.5 (dÃ¼z)",c:"#EF4444"}]; return (<VizBox title="Temperature Etkisi" color="#F59E0B"><div style={{display:"flex",gap:14,flexWrap:"wrap"}}>{temps.map((tmp,ti)=>{const probs=calcP(tmp.t);const mx=Math.max(...probs);return(<div key={ti} style={{flex:1,minWidth:140}}><div style={{fontSize: 14,fontWeight:600,color:tmp.c,marginBottom:6}}>{tmp.label}</div>{probs.map((p,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:4,marginBottom:3}}><span style={{width:14,fontSize: 13,fontFamily:"'Fira Code',monospace",color:VB.muted}}>{labels[i]}</span><div style={{flex:1,height:12,background:"rgba(255,255,255,0.03)",borderRadius:6,overflow:"hidden"}}><div style={{height:"100%",width:`${(p/mx)*100}%`,borderRadius:6,background:tmp.c}}/></div><span style={{width:35,fontSize: 11,fontFamily:"'Fira Code',monospace",color:VB.dim,textAlign:"right"}}>{(p*100).toFixed(0)}%</span></div>))}</div>);})}</div><div style={{marginTop:8,fontSize: 12,color:VB.dim}}>Tâ†“: sivri(deterministik) â€¢ T=1: orijinal â€¢ Tâ†‘: dÃ¼z(rastgele)</div></VizBox>); };

const KVCacheViz = () => (<VizBox title="KV Cache â€” O(nÂ²) â†’ O(n)" color="#10B981"><div style={{display:"flex",gap:20,flexWrap:"wrap"}}><div><div style={{fontSize: 13,color:VB.muted,marginBottom:6}}>Cache BÃ¼yÃ¼me</div>{[0,1,2,3,4].map(pos=>(<div key={pos} style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}><span style={{width:44,fontSize: 12,fontFamily:"'Fira Code',monospace",color:VB.muted}}>pos={pos}</span>{Array.from({length:pos+1},(_,k)=>(<div key={k} style={{padding:"3px 8px",borderRadius:4,fontSize: 12,fontFamily:"'Fira Code',monospace",background:k===pos?"rgba(16,185,129,.2)":"rgba(14,165,233,.1)",color:k===pos?"#10B981":"#0EA5E9",fontWeight:k===pos?700:400}}>k{k}</div>))}{pos<4&&<span style={{fontSize: 11,color:"#10B981"}}>â†yeni</span>}</div>))}</div><div style={{flex:1,minWidth:200,display:"flex",gap:10}}><div style={{flex:1,padding:"8px 12px",borderRadius:8,background:"rgba(239,68,68,.06)"}}><div style={{fontSize: 13,fontWeight:600,color:"#EF4444"}}>Cache Yok</div><div style={{fontSize: 12,color:VB.muted,marginTop:4}}>pos=5: 6 token hesapla</div><div style={{fontSize: 15,fontFamily:"'Fira Code',monospace",fontWeight:700,color:"#EF4444",marginTop:4}}>O(nÂ²)</div></div><div style={{flex:1,padding:"8px 12px",borderRadius:8,background:"rgba(16,185,129,.06)"}}><div style={{fontSize: 13,fontWeight:600,color:"#10B981"}}>KV Cache</div><div style={{fontSize: 12,color:VB.muted,marginTop:4}}>pos=5: 1 yeni+5 cache</div><div style={{fontSize: 15,fontFamily:"'Fira Code',monospace",fontWeight:700,color:"#10B981",marginTop:4}}>O(n)</div></div></div></div></VizBox>);

const GPTFamilyViz = () => { const lang = useLang();  const ms=[{n:"Bu Kod â˜…",p:"~5K",l:"1",e:"16",c:"8",y:"2024",cl:"#0EA5E9"},{n:"GPT-1",p:"117M",l:"12",e:"768",c:"512",y:"2018",cl:"#94A3B8"},{n:"GPT-2",p:"1.5B",l:"48",e:"1,600",c:"1K",y:"2019",cl:"#94A3B8"},{n:"GPT-3",p:"175B",l:"96",e:"12,288",c:"2K",y:"2020",cl:"#94A3B8"},{n:"GPT-4",p:"~1T+",l:"?",e:"?",c:"128K",y:"2023",cl:"#94A3B8"}]; return (<VizBox title={lang === "tr" ? "GPT Ailesi KarÅŸÄ±laÅŸtÄ±rma" : "GPT Family Comparison"} color="#6366F1"><div style={{overflowX:"auto"}}><div style={{display:"grid",gridTemplateColumns:"120px repeat(5,1fr)",gap:2,minWidth:450}}>{["Model","Param","Layer","n_embd","Context",lang === "tr" ? lang === "tr" ? "YÄ±l" : "Year" : "Year"].map((h,i)=>(<div key={i} style={{padding:"6px 8px",background:"rgba(255,255,255,0.04)",fontSize: 12,fontWeight:700,color:"#0EA5E9"}}>{h}</div>))}{ms.map((m,ri)=>[m.n,m.p,m.l,m.e,m.c,m.y].map((cell,ci)=>(<div key={`${ri}-${ci}`} style={{padding:"5px 8px",fontSize: 13,fontFamily:ci>0?"'Fira Code',monospace":"inherit",fontWeight:ci===0||ri===0?700:400,color:ri===0?m.cl:VB.txt,background:ri===0?`${m.cl}08`:"transparent"}}>{cell}</div>)))}</div></div><div style={{marginTop:10,padding:"6px 12px",background:"rgba(16,185,129,.06)",borderRadius:8,fontSize: 13,color:"#10B981"}}>Temel mekanizma hep aynÄ±: attention + MLP + residual + norm + CE + backprop + Adam</div></VizBox>); };

const ResidualViz = () => (<VizBox title="Residual Connections â€” Gradient Highway" color="#10B981"><div style={{display:"flex",gap:24,flexWrap:"wrap"}}><div><div style={{fontSize: 14,fontWeight:600,color:"#EF4444",marginBottom:6}}>Residual OLMADAN</div><div style={{display:"flex",alignItems:"center",gap:4}}>{[1,.7,.4,.15,.05].map((op,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:4}}><div style={{padding:"6px 10px",borderRadius:6,background:`rgba(239,68,68,${op})`,fontSize: 13,fontFamily:"'Fira Code',monospace",color:op>0.3?"#fff":"#EF4444"}}>f{i+1}</div>{i<4&&<span style={{color:VB.dim,fontSize: 13}}>â†’</span>}</div>))}</div><div style={{fontSize: 12,color:"#EF4444",marginTop:4}}>Gradient kÃ¼Ã§Ã¼lÃ¼r â†’ uzak katmanlar Ã¶ÄŸrenemez</div></div><div><div style={{fontSize: 14,fontWeight:600,color:"#10B981",marginBottom:6}}>Residual Ä°LE</div><div style={{display:"flex",alignItems:"center",gap:4}}>{[1,1,1,1,1].map((_,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:4}}><div style={{padding:"6px 10px",borderRadius:6,background:"rgba(16,185,129,0.5)",fontSize: 13,fontFamily:"'Fira Code',monospace",color:"#fff"}}>f{i+1}+x</div>{i<4&&<span style={{color:VB.dim,fontSize: 13}}>â†’</span>}</div>))}</div><div style={{fontSize: 12,color:"#10B981",marginTop:4}}>âˆ‚y/âˆ‚x = âˆ‚f/âˆ‚x + 1 â† +1 her zaman geÃ§er!</div></div></div></VizBox>);

const SoftmaxViz = () => { const lang = useLang();  const logits=[2.4,0.0,-1.5]; const labels=["A","B","C"]; const mx=Math.max(...logits); const exps=logits.map(l=>Math.exp(l-mx)); const sum=exps.reduce((a,b)=>a+b); const probs=exps.map(e=>e/sum); return (<VizBox title={lang === "tr" ? "Softmax: Logits â†’ OlasÄ±lÄ±k" : "Softmax: Logits â†’ Probability"} color="#8B5CF6"><div style={{display:"flex",gap:16,alignItems:"center",justifyContent:"center",flexWrap:"wrap"}}><div style={{textAlign:"center"}}><div style={{fontSize: 13,color:VB.muted,marginBottom:4}}>Logits</div>{logits.map((l,i)=>(<div key={i} style={{fontSize: 17,fontFamily:"'Fira Code',monospace",color:VB.txt,padding:"2px 0"}}>{labels[i]}: {l.toFixed(1)}</div>))}</div><div style={{fontSize: 21,color:VB.dim}}>â†’</div><div style={{textAlign:"center"}}><div style={{fontSize: 13,color:VB.muted,marginBottom:4}}>exp(x-max)</div>{exps.map((e,i)=>(<div key={i} style={{fontSize: 17,fontFamily:"'Fira Code',monospace",color:"#F59E0B",padding:"2px 0"}}>{e.toFixed(2)}</div>))}</div><div style={{fontSize: 21,color:VB.dim}}>â†’</div><div style={{textAlign:"center"}}><div style={{fontSize: 13,color:VB.muted,marginBottom:4}}>Ã· toplam</div>{probs.map((p,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:6,padding:"2px 0"}}><span style={{fontSize: 17,fontFamily:"'Fira Code',monospace",color:"#10B981",fontWeight:700}}>{(p*100).toFixed(0)}%</span><div style={{width:80,height:12,background:"rgba(255,255,255,0.03)",borderRadius:6,overflow:"hidden"}}><div style={{height:"100%",width:`${p*100}%`,borderRadius:6,background:"#10B981"}}/></div></div>))}</div></div><div style={{marginTop:8,textAlign:"center",fontSize: 12,color:VB.dim}}>max-subtraction trick: exp(1000)=âˆ â†’ exp(1000-1000)=1 âœ“</div></VizBox>); };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEW VISUALIZATION COMPONENTS â€” Inspired by PPTX Enriched Visual Guide

export { CoursePipelineViz, TokenFlowViz, EmbeddingFlowViz, CompGraphViz, OpGradTableViz, ArchPipelineViz, AttentionFlowViz, CausalMaskViz, MLPFlowViz, ParamDistViz, TrainingCycleViz, LossTableViz, AdamEvolutionViz, InferenceTimelineViz, TemperatureViz, KVCacheViz, GPTFamilyViz, ResidualViz, SoftmaxViz };
